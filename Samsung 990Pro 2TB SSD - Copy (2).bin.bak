4194304 16384
OS.e 1 1
calc.e 1 2
newtest.txt 1 3
accounts.db 1 4
txt.e 1 5
END
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































@----------------------------------
@Constant Strings (Menu Items) : C0 -> C4
CONST C0 ----------------------------------------------
CONST C1 "Welcome to PCBox v"
CONST C2 1.0	@OS Version
CONST C3 "Use help to display a list of commands"
CONST C4 "~[PCBox - " @Temp TODO: Account system (hash passwords)
@----------------------------------
@Error Definitions
ERR E0 "File $ doesn't exist"
ERR E1 "File $ has been removed successfuly"
ERR E2 "File $ already exists!"
ERR E3 "File $ created successfuly"
ERR E4 "File $ successfuly renamed to $"
@----------------------------------
@Frequently Used Numbers
REGSET S:100 10 @Newline terminator (\n) + Used in string to number stuff
REGSET S:101 > @waiting for commands
REGSET S:102 : @Username & password seperator in accounts.db
REGSET S:103 0 @Used in many places
REGSET S:104 48 @Used in string to number stuff
@Used for finding EOF
REGSET S:105 E
REGSET S:106 N
REGSET S:107 D
REGSET S:108 10  TODO: Use this for something else
REGSET S:109 ]
REGSET S:130 32 @Space, used for tokenizing user input
REGSET S:131 86400 @(Seconds in day)
REGSET S:132 3600  @(Seconds in an hour)
REGSET S:133 60 @(Yeah u know what this is)
REGSET S:134 4
REGSET S:135 34
@----------------------------------
@Hashed Commands
REGSET S:110 210714636462 @help
REGSET S:111 6385120071 @cls
REGSET S:112 249906522640248705 @Shutdown
REGSET S:113 193504740 @rm
REGSET S:114 6385477923 @mkf
REGSET S:115 229481155741629 @rename
REGSET S:116 210729011988 @time
REGSET S:117 6954030892083 @start
REGSET S:118 6385152708 @dir
REGSET S:119 210711002436 @echo
@----------------------------------
@Help Menu Stuff : C5 -> C16
CONST C5 "CLS         Clears the Screen"
CONST C6 "COPY        Copying files"
CONST C7 "TIME        Displays the current time"
CONST C8 "DIR         List all files in the current directory"
CONST C9 "ECHO        Displays a message"
CONST C10 "HELP        Displays this menu"
CONST C11 "MF          Creates a file with a given name"
CONST C12 "MD          Creates a directory with a given name"
CONST C13 "RM          Removes a given file"
CONST C14 "RMDIR       Removes a given directory"
CONST C15 "RENAME      Renames a file or directory"
CONST C16 "SHUTDOWN    System shutdown"
CONST C17 "SLEEP       Puts the system into sleep"
CONST C18 "START       Starts a given program"
CONST C19 "Invalid command!"
@----------------------------------
@User Login
CONST C20 "Enter your Username:"
CONST C21 "Enter your Password:"
CONST C22 "Wrong Username/Password entered!"
@----------------------------------
@Time & Date
CONST C23 "The time in your timezone is: "
@----------------------------------
@General OS Stuff
RUNPROC User_Login
RUNPROC PRINT_BOOT_MENU
:Waiting_For_CMD
RUNPROC PRINT_COMMAND_WAIT
RUNPROC Get_Input_To_A0_An
RUNPROC HASH_A0toAn_ToX
RUNPROC Execute_Command_From_X
GOTO Waiting_For_CMD
@----------------------------------
@Procedures
@---------------------------------
PROC Start_Program:
REGSET X 0
RUNPROC Get_Input_To_A0_An
FEX X A
NOT X
CRUN X CERR E0 A
CRUN X OUTPUT S:100
CRUN X ENDPROC
FOPEN A
LOADTOMEMORY X
REGCOPY PC MDR
ADD MDR S:134 MDR
REGSET MAR 10
MEMWRITE
REGCOPY X PC
UNLOADFROMMEMORY
ENDPROC
@---------------------------------
PROC Echo_Input:
REGSET X 0 @Where the input goes
REGSET Y 0 @Logic
:Echo_Next_Char
INPUT X
EQ X S:103 Y
CRUN Y OUTPUT S:100
CRUN Y ENDPROC
EQ X S:135 Y
CRUN Y GOTO Echo_Next_Char
OUTPUT X
GOTO Echo_Next_Char
ENDPROC
@---------------------------------
PROC Get_Input_To_A0_An:
@Used Registers:
REGSET X 0 @Input
REGSET U 0 @Used for 0 value
REGSET V 0 @Comparison result
REGSET Y -1 @Itterator
:Get_Input_To_A0_An_Iterate
INC Y
INPUT X
EQ X S:103 U @Is input finished?
EQ X S:130 V @Or space is detected?
OR U V V
CRUN V GOTO Get_Input_To_A0_An_END @End reading stdin then
REGCOPY X A:Y
GOTO Get_Input_To_A0_An_Iterate
:Get_Input_To_A0_An_END
REGCOPY S:103 A:Y
ENDPROC
@---------------------------------
PROC Print_Time:
REGSET X 0
REGSET Y 0
REGSET Z 0
OUTPUT C23
GETTIME X
GETTIMEZONE Y
ADD X Y X
LO X S:131 X @(86400)
DIV X S:132 Z @(Get number of hours)
LOWER Z S:100 U @2 digits padding
CRUN U OUTPUT S:104
RUNPROC Print_Number_Z_A
OUTPUT S:102
LO X S:132 X
DIV X S:133 Z
LOWER Z S:100 U @2 digits padding
CRUN U OUTPUT S:104
RUNPROC Print_Number_Z_A
OUTPUT S:102
LO X S:133 Z
LOWER Z S:100 U @2 digits padding
CRUN U OUTPUT S:104
RUNPROC Print_Number_Z_A
OUTPUT S:100
REGSET U 1
ENDPROC
@---------------------------------
PROC List_Files:
REGSET U 0 @Iterator
REGSET V 0 @Logic stuff
:Next_File
GETFILEINFO U A
INC U
EQ A S:103 V
CRUN V ENDPROC
RUNPROC PRINT_A_Z
OUTPUT S:100
GOTO Next_File
ENDPROC
@---------------------------------
PROC PRINT_A_Z:
REGSET Z -1 @Iterator
REGSET Y 0 @Logic
:A_Next_Char
INC Z
EQ A:Z S:103 Y
CRUN Y ENDPROC
OUTPUT A:Z
GOTO A_Next_Char
ENDPROC
@---------------------------------
PROC Print_Number_Z_A:
REGSET U 0 (@Iterator)
REGSET V 0 (Used for logic)
@Convert number to string:
:Number_To_String_Continue
LO Z S:100 A:U
DIV Z S:100 Z
INC U
EQ Z S:103 V
NOT V
CRUN V GOTO Number_To_String_Continue
@Print in Reverse:
:Print_In_Reverse_Continue
DEC U
ADD A:U S:104 A:U (@Convert to ASCII character)
OUTPUT A:U
EQ U S:103 V
NOT V
CRUN V GOTO Print_In_Reverse_Continue
ENDPROC
@---------------------------------
PROC Get_Input_To_S0_Sn:
@Used Registers:
REGSET X 0 @Input
REGSET U 0 @Used for 0 value
REGSET V 0 @Comparison result
REGSET Y -1 @Itterator
:Get_Input_To_S0_Sn_Iterate
INC Y
INPUT X
EQ X S:103 U @Is input finished?
EQ X S:130 V @Or space is detected?
OR U V V
CRUN V GOTO Get_Input_To_S0_Sn_END @End reading stdin then
REGCOPY X S:Y
GOTO Get_Input_To_S0_Sn_Iterate
:Get_Input_To_S0_Sn_END
REGCOPY S:103 S:Y
ENDPROC
@---------------------------------
PROC REMOVE_FILE:
REGSET U 0
RUNPROC Get_Input_To_A0_An
FEX U A
NOT U
CRUN U CERR E0 A
CRUN U OUTPUT S:100
CRUN U ENDPROC
RM A
CERR E1 A
OUTPUT S:100
REGSET U 1
ENDPROC
@---------------------------------
PROC MAKE_FILE:
REGSET U 0
RUNPROC Get_Input_To_A0_An
FEX U A
CRUN U CERR E2 A
CRUN U OUTPUT S:100
CRUN U ENDPROC
MKF A
CERR E3 A
OUTPUT S:100
REGSET U 1
ENDPROC
@---------------------------------
PROC RENAME_FILE:
REGSET U 0
RUNPROC Get_Input_To_A0_An
RUNPROC Get_Input_To_S0_Sn
FEX U A
NOT U
CRUN U CERR E0 A
CRUN U OUTPUT S:100
CRUN U ENDPROC
FEX U S
CRUN U CERR E2 S
CRUN U OUTPUT S:100
CRUN U ENDPROC
RENAME A S
CERR E4 A S
OUTPUT S:100
REGSET U 1
ENDPROC
@---------------------------------
PROC PRINT_HELP_MENU:
@Used Registers:
REGSET U 4 @Iterator
REGSET V 0
REGSET Z 17 @Maximum
:PRINT_HELP_MENU_REPEAT
INC U
OUTPUT C:U
OUTPUT S:100 @Newline
EQ U Z V
NOT V
CRUN V GOTO PRINT_HELP_MENU_REPEAT
ENDPROC
@---------------------------------
PROC PRINT_BOOT_MENU:
OUTPUT C0
OUTPUT S:100
OUTPUT C1
OUTPUT C2
OUTPUT S:100
OUTPUT C3
OUTPUT S:100
OUTPUT C0
OUTPUT S:100
ENDPROC
@---------------------------------
PROC PRINT_COMMAND_WAIT:
OUTPUT C4
REGSET MAR 50
REGSET MDR 0
:PRINT_COMMAND_WAIT_Repeat
MEMLOAD
INC MAR
EQ MDR S:103 A:255 @S:103 -> Zero is stored | A:255 Result
NOT A:255
CRUN A:255 OUTPUT MDR
CRUN A:255 GOTO PRINT_COMMAND_WAIT_Repeat
OUTPUT S:109
OUTPUT S:101
ENDPROC
@---------------------------------
PROC HASH_A0toAn_ToX:
@Used Registers
REGSET U 0
REGSET V 0
REGSET X 5381 @Hash Key
REGSET Y -1 @Iterator
REGSET Z 5 @Shift Value
:HASH_Iterate
INC Y
SHIFTBACK X Z V
ADD X V X
ADD X A:Y X
REGSET U 0
EQ A:Y U U
NOT U
CRUN U GOTO HASH_Iterate
ENDPROC
@---------------------------------
PROC Hash_Input_To_X:
OUTPUT C21
REGSET V 0
REGSET X 5381
REGSET Y 0
REGSET A:255 5 @Shift Value
DISABLEECHO
:HASH_Iterate_File
INPUT V
EQ V S:103 Y
CRUN Y ENABLEECHO
CRUN Y ENDPROC
SHIFTBACK X A:255 Y
ADD X Y X
ADD X V X
NOT V
GOTO HASH_Iterate_File
ENDPROC
@---------------------------------
PROC Execute_Command_From_X:
REGSET U 0 @Used for logic stuff
EQ X S:110 U
CRUN U RUNPROC PRINT_HELP_MENU
CRUN U ENDPROC
EQ X S:111 U
CRUN U CLS
CRUN U ENDPROC
EQ X S:112 U
CRUN U SHUTDOWN
CRUN U ENDPROC
EQ X S:113 U
CRUN U RUNPROC REMOVE_FILE
CRUN U ENDPROC
EQ X S:114 U
CRUN U RUNPROC MAKE_FILE
CRUN U ENDPROC
EQ X S:115 U
CRUN U RUNPROC RENAME_FILE
CRUN U ENDPROC
EQ X S:116 U
CRUN U RUNPROC Print_Time
CRUN U ENDPROC
EQ X S:117 U
CRUN U RUNPROC Start_Program
CRUN U ENDPROC
EQ X S:118 U
CRUN U RUNPROC List_Files
CRUN U ENDPROC
EQ X S:119 U
CRUN U RUNPROC Echo_Input
CRUN U ENDPROC
OUTPUT C19
OUTPUT S:100
ENDPROC
@---------------------------------
PROC Load_UserName_Input_Into_RAM:
OUTPUT C20
REGSET MAR 50 @Starting point
REGSET MDR 0
:Load_UserName_Input_Into_RAM_NextChar
INPUT MDR
MEMWRITE
INC MAR
EQ MDR S:103 MDR
CRUN MDR ENDPROC
GOTO Load_UserName_Input_Into_RAM_NextChar
ENDPROC
@---------------------------------
PROC GOTO_NEXT_LINE: @Skips everything until a newline terminator is found
@Uses U, V
:GOTO_NEXT_LINE_Repeat
RNC U V
INC U
EQ V S:100 V
CRUN V ENDPROC
GOTO GOTO_NEXT_LINE_Repeat
ENDPROC
@---------------------------------
PROC Search_For_EOF:
@Uses U, V, Y
REGSET Y 0
REGSET A:255 104
REGSET A:256 5
:Search_For_EOF_Repeat
INC U
INC Y
RNC U V
ADD Y A:255 Y
EQ V S:Y V
SUB Y A:255 Y
CRUN V GOTO Search_For_EOF_Repeat
REGCOPY Y A:255
EQ Y A:256 Y
SUB U A:255 U @Reset file position
ENDPROC
@---------------------------------
PROC User_Login:
@Used Registers
REGSET U 0
REGSET V 0
REGSET Z 0
FEX U accounts.db
NOT U
CRUN U MKF accounts.db
FOPEN accounts.db
:Login_Failed
REGSET U 0 @iterator
RUNPROC Load_UserName_Input_Into_RAM
:Read_Next_Username
REGSET MAR 50
REGSET MDR 0
REGSET Z 0
:Next_Char
MEMLOAD
RNC U V @Read the uth character into v
INC MAR
INC U
EQ V MDR Z
CRUN Z GOTO Next_Char
EQ V S:102 Z @Correct Username entered
CRUN Z GOTO Read_Password
RUNPROC GOTO_NEXT_LINE
RUNPROC Search_For_EOF
CRUN Y GOTO Read_Password
GOTO Read_Next_Username
:Read_Password
RUNPROC Hash_Input_To_X
REGSET Y 0
:String_To_Number_Iterate
RNC U V
INC U
EQ V S:100 A:255 @TODO: change this
CRUN A:255 GOTO User_Final_Output
MUL Y S:100 Y @Multiply by 10
SUB V S:104 V
ADD Y V Y
GOTO String_To_Number_Iterate
:User_Final_Output
EQ Y X Y @Compare the db with user input
AND Y Z Y @If Username & password are both correct, then
CRUN Y GOTO System_Start
OUTPUT C22
OUTPUT S:100
GOTO Login_Failed
:System_Start
CLS
ENDPROC
END




































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































@Simple Calculator (4 Main Operations) for PCBox
@----------------------------------
@Constant Strings:
CONST C50 "Enter the First Number(Enter q to Exit): "
CONST C51 "Enter the Second Number(Enter q to Exit): "
CONST C52 "Enter the Desired Operation(Enter q to Exit): "
CONST C51 "The Answer is: "
@----------------------------------
@Operations
REGSET S:150 +
REGSET S:151 -
REGSET S:152 /
REGSET S:153 *
@----------------------------------
:Next_Calculation
CLS
OUTPUT C50
RUNPROC Get_Integer_Input_To_X
REGCOPY X MDR
REGSET MDR 5
MEMWRITE
OUTPUT C51
RUNPROC Get_Integer_Input_To_X
REGCOPY X MDR
REGSET MDR 6
MEMWRITE
OUTPUT C52
INPUT X
EQ X S:150 Y
@----------------------------------
@Procedures
PROC Get_Integer_Input_To_X:
REGSET X 0 @Output
REGSET Y 0 @Where input is stores and processed
REGSET U 0 @Logic
:Get_Integer_Input_To_X_Repeat
MUL X S:100 X
INPUT Y
EQ Y S:103 U
CRUN U ENDPROC
SUB Y S:104 Y
ADD X Y X
GOTO Get_Integer_Input_To_X_Repeat
ENDPROC
PROC Quit_Calc:
REGSET MAR 10
MEMLOAD
REGCOPY MDR PC
ENDPROC
END



























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































Laaaaaaine2
Line3
Line4
END





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































FarFarbFFarbod:6383257999
Fatemeh:6383366863
Helia:7572787954113592
END

END
4113592
END

END
-----------------
@Constant Strings
CONST C50 "Enter the Filename to Open: "
CONST C51 "Error: file doesn't exist"
CONST C52 "Press F11 to Exit Discarding Changes"
CONST C53 "Press F12 to Exit Saving Changes"
@----------------------------------
@Frequently Used Values
REGSET S:150 75 @Left Arrow
REGSET S:151 77 @Right arrow
REGSET S:152 8 @Backspace
REGSET S:153 10 @Enter
REGSET S:154 72 @Up arrow
REGSET S:155 80 @Down arrow
REGSET S:156 600 @Lines handler starting points
REGSET S:157 100 @String starting points
REGSET S:158 133 @F11
REGSET S:159 134 @F12
@----------------------------------
:Get_File_Input_Again
OUTPUT C50
RUNPROC Get_Input_To_A0_An @Get filename
FEX X A
NOT X
CRUN X OUTPUT C51
CRUN X OUTPUT S:100
CRUN X GOTO Get_File_Input_Again
FOPEN A @Open said file
CLS
RUNPROC Print_File
@From here on, don't touch Z ,U And A (A is the line count thingy)
DEC A
REGSET Y 0 @Used for logic
REGCOPY MAR Z @Store text len
REGCOPY Z U @Cursor position
REGCOPY A S:160 @Maximum number of lines, store it.
INC S:156
:Next_Key
GETKEY X
EQ X S:150 Y
CRUN Y RUNPROC MOVE_CURSOR_BACK
CRUN Y GOTO Next_Key
EQ X S:151 Y
CRUN Y RUNPROC MOVE_CURSOR_FORWARD
CRUN Y GOTO Next_Key
EQ X S:154 Y
CRUN Y RUNPROC MOVE_CURSOR_UP
CRUN Y GOTO Next_Key
EQ X S:155 Y
CRUN Y RUNPROC MOVE_CURSOR_DOWN
CRUN Y GOTO Next_Key
EQ X S:152 Y
CRUN Y RUNPROC ERASE_CHARACTER
CRUN Y GOTO Next_Key
EQ X S:158 Y
CRUN Y RUNPROC Quit_Txt
EQ X S:159 Y
CRUN Y RUNPROC Txt_Exit_Save
RUNPROC INSERT_CHARACTER
GOTO Next_Key
@----------------------------------
@Procedures
@----------------------------------
PROC Quit_Txt:
CLS
REGSET MAR 10
MEMLOAD
REGCOPY MDR PC
ENDPROC
@----------------------------------
PROC Txt_Exit_Save:
REGSET Y 0 @Helper iterator
REGSET V 0 @Logic
REGCOPY S:157 MAR
DEBUG
:Write_To_File_Txt_Next_Char
MEMLOAD
WNC Y MDR
LOWER MAR Z V
NOT V
CRUN V RUNPROC Write_EOF
CRUN V RUNPROC Quit_Txt
INC Y
INC MDR
GOTO Write_To_File_Txt_Next_Char
ENDPROC
@----------------------------------
PROC Write_EOF:
WNC Z S:105
INC Z
WNC Z S:106
INC Z
WNC Z S:107
INC Z
WNC Z S:100
ENDPROC
@----------------------------------
PROC Get_Input_To_A0_An:
@Used Registers:
REGSET X 0 @Input
REGSET U 0 @Used for 0 value
REGSET V 0 @Comparison result
REGSET Y -1 @Itterator
:Get_Input_To_A0_An_Iterate
INC Y
INPUT X
EQ X S:103 U @Is input finished?
EQ X S:130 V @Or space is detected?
OR U V V
CRUN V GOTO Get_Input_To_A0_An_END @End reading stdin then
REGCOPY X A:Y
GOTO Get_Input_To_A0_An_Iterate
:Get_Input_To_A0_An_END
REGCOPY S:103 A:Y
ENDPROC
@----------------------------------
PROC Print_File:
REGCOPY S:156 A @Iterator for line lenghts
REGSET S 0 @Temp buffer for MAR value
REGSET X 0 @Logic
REGSET Y 0 @Also Logic
REGSET U 0 @Iterator
REGSET Z 0 @Temp buffer
REGCOPY S:157 MAR @Write the outputed character into RAM, for later use
OUTPUT C52
OUTPUT S:100
OUTPUT C53
OUTPUT S:100
OUTPUT C0
OUTPUT S:100
:Print_File_Nextchar
RNC U Z
EQ Z S:100 X
CRUN X REGCOPY MAR S
CRUN X REGCOPY A MAR
CRUN X REGCOPY S MDR
CRUN X INC MDR
CRUN X MEMWRITE
CRUN X REGCOPY S MAR
CRUN X INC A
CRUN X RUNPROC Search_For_EOF
CRUN Y ENDPROC @If EOF is found end the search
INC U
REGCOPY Z MDR
OUTPUT Z
MEMWRITE
INC MAR
GOTO Print_File_Nextchar
ENDPROC
@----------------------------------
PROC Search_For_EOF:
@Uses U, V, Y
REGSET Y 0
REGSET A:255 104
REGSET A:256 5
:Search_For_EOF_Repeat
INC U
INC Y
RNC U V
ADD Y A:255 Y
EQ V S:Y V
SUB Y A:255 Y
CRUN V GOTO Search_For_EOF_Repeat
REGCOPY Y A:255
EQ Y A:256 Y
SUB U A:255 U @Reset file position
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_FORWARD:
REGCOPY A MAR
MEMLOAD
LOWER U Z X @Don't let the cursor go further than the text's length
NOT X
CRUN X ENDPROC
DEC MDR
LOWER U MDR X
NOT X
CRUN X ENDPROC
REGCOPY U MAR
MEMLOAD
OUTPUT MDR
INC U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_BACK:
HIGHER U S:103 X
DEC A
REGCOPY A MAR
MEMLOAD
HIGHER U MDR X
INC A
NOT X
CRUN X ENDPROC
OUTPUT S:152
DEC U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_UP:
DEC A
LOWER A S:156 X
INC A
INC A
CRUN A EQ A S:156 U
DEC A
DEC A
NOT U
CRUN X CRUN U CURSORUP
CRUN X CRUN U DEC A
CRUN X REGCOPY S:157 U
CRUN X INC A
CRUN X ENDPROC
DEC A
REGCOPY A MAR
MEMLOAD
INC A
CURSORUP
REGCOPY MDR U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_DOWN:
LOWER A S:160 X
NOT X
CRUN X DEC A
REGCOPY A MAR
MEMLOAD
REGCOPY MDR U
NOT X
CRUN X CURSORDOWN
INC A
REGSET Y 1
ENDPROC
@----------------------------------
PROC INSERT_CHARACTER:
@---------
@Update RAM
REGSET V 0 @Used for Logic operations
REGCOPY Z Y @Helper incremenetor
DEC Y
REGCOPY S:160 MAR
REGCOPY Z MDR
INC MDR
MEMWRITE
REGCOPY Z MAR
INC Z @Add text len by 1
:Shift_Next_Char
COPY Y @Copy Y to MAR (From RAM)
EQ Y U V
CRUN V GOTO Print_Characters
DEC MAR
DEC Y
GOTO Shift_Next_Char
:Print_Characters
REGCOPY X MDR
DEC MAR
MEMWRITE
:Print_Next_Char
EQ MAR Z V
CRUN V GOTO Reset_Cursor
MEMLOAD
OUTPUT MDR
INC MAR
GOTO Print_Next_Char
:Reset_Cursor
INC U
LOWER A S:160 V
CRUN V REGCOPY A X @Backup A Value
CRUN V RUNPROC SET_CURSOR_Y
CRUN V REGCOPY X A @Restore backuped value
CRUN V RUNPROC SET_CURSOR_X
CRUN V ENDPROC
REGCOPY MAR X @Backup MAR value
@Update line length
REGCOPY A MAR
MEMLOAD
INC MDR
MEMWRITE
REGCOPY X MAR @Restore backuped value
:Cursor_Back_Repeat
OUTPUT S:152
DEC MAR
EQ MAR U V
NOT V
CRUN V GOTO Cursor_Back_Repeat
ENDPROC
PROC SET_CURSOR_Y:
REGCOPY A MAR
:Cursor_Up_Repeat
MEMLOAD
INC MDR
MEMWRITE
CURSORUP
INC MAR
EQ MAR S:160 V
CRUN V ENDPROC
GOTO Cursor_Up_Repeat
ENDPROC
PROC SET_CURSOR_X:
LOWER A S:156 V
CRUN V REGCOPY S:157 MAR
CRUN V GOTO Cursor_Forward_Insert_Repeat
REGCOPY A MAR
DEC MAR
MEMLOAD
REGCOPY MDR MAR
:Cursor_Forward_Insert_Repeat
EQ MAR U V
CRUN V ENDPROC
MEMLOAD
OUTPUT MDR
INC MAR
@Inja Boodesh
GOTO Cursor_Forward_Insert_Repeat
ENDPROC
@----------------------------------
PROC ERASE_CHARACTER:
@Check if erasing is allowed or not
LOWER A S:156 V
CRUN V HIGHER U S:157 Y
CRUN V NOT Y
CRVUN V CRUN Y REGSET V 1
CRUN V CRUN Y ENDPROC
REGCOPY A MAR
DEC MAR
MEMLOAD
HIGHER U MDR V
NOT V
CRUN V REGSET Y 1
CRUN V ENDPROC
@Update RAM
REGSET V 0 @Used for Logic operations
REGCOPY U Y @Helper incremenetor
REGCOPY S:160 MAR
REGCOPY Z MDR
DEC MDR
MEMWRITE
REGCOPY U MAR
DEC MAR
DEC U
DEC Z @Decrement text len
:Shift_Next_Char_Back
COPY Y @Copy Y to MAR (From RAM)
EQ Y Z V
CRUN V GOTO Print_Characters_Back
INC MAR
INC Y
GOTO Shift_Next_Char_Back
:Print_Characters_Back
CLS
OUTPUT C52
OUTPUT S:100
OUTPUT C53
OUTPUT S:100
OUTPUT C0
OUTPUT S:100
REGCOPY S:157 MAR
:Print_Next_Char_Back
EQ MAR Z V
CRUN V GOTO Reset_Cursor_Back
MEMLOAD
OUTPUT MDR
INC MAR
GOTO Print_Next_Char_Back
:Reset_Cursor_Back
LOWER A S:160 V
CRUN V REGCOPY A X @Backup A Value
CRUN V RUNPROC SET_CURSOR_Y_Back
CRUN V REGCOPY X A @Restore backuped value
CRUN V RUNPROC SET_CURSOR_X
CRUN V ENDPROC
REGCOPY MAR X @Backup MAR value
@Update line length
REGCOPY A MAR
MEMLOAD
DEC MDR
MEMWRITE
REGCOPY X MAR @Restore backuped value
:Cursor_Back_Repeat_Back
OUTPUT S:152
DEC MAR
EQ MAR U V
NOT V
CRUN V GOTO Cursor_Back_Repeat_Back
REGSET Y 1
ENDPROC
PROC SET_CURSOR_Y_Back:
REGCOPY A MAR
:Cursor_Up_Repeat_Back
MEMLOAD
DEC MDR
MEMWRITE
CURSORUP
INC MAR
EQ MAR S:160 V
CRUN V ENDPROC
GOTO Cursor_Up_Repeat_Back
ENDPROC
END










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































@Simple Text Editor Using Simple stdin Buffer Techniques
@Written for PCBox
@----------------------------------
@Constant Strings
CONST C50 "Enter the Filename to Open: "
CONST C51 "Error: file doesn't exist"
CONST C52 "Press F11 to Exit Discarding Changes"
CONST C53 "Press F12 to Exit Saving Changes"
@----------------------------------
@Frequently Used Values
REGSET S:150 75 @Left Arrow
REGSET S:151 77 @Right arrow
REGSET S:152 8 @Backspace
REGSET S:153 10 @Enter
REGSET S:154 72 @Up arrow
REGSET S:155 80 @Down arrow
REGSET S:156 600 @Lines handler starting points
REGSET S:157 100 @String starting points
REGSET S:158 133 @F11
REGSET S:159 134 @F12
@----------------------------------
:Get_File_Input_Again
OUTPUT C50
RUNPROC Get_Input_To_A0_An @Get filename
FEX X A
NOT X
CRUN X OUTPUT C51
CRUN X OUTPUT S:100
CRUN X GOTO Get_File_Input_Again
FOPEN A @Open said file
CLS
RUNPROC Print_File
@From here on, don't touch Z ,U And A (A is the line count thingy)
DEC A
REGSET Y 0 @Used for logic
REGCOPY MAR Z @Store text len
REGCOPY Z U @Cursor position
REGCOPY A S:160 @Maximum number of lines, store it.
INC S:156
:Next_Key
GETKEY X
EQ X S:150 Y
CRUN Y RUNPROC MOVE_CURSOR_BACK
CRUN Y GOTO Next_Key
EQ X S:151 Y
CRUN Y RUNPROC MOVE_CURSOR_FORWARD
CRUN Y GOTO Next_Key
EQ X S:154 Y
CRUN Y RUNPROC MOVE_CURSOR_UP
CRUN Y GOTO Next_Key
EQ X S:155 Y
CRUN Y RUNPROC MOVE_CURSOR_DOWN
CRUN Y GOTO Next_Key
EQ X S:152 Y
CRUN Y RUNPROC ERASE_CHARACTER
CRUN Y GOTO Next_Key
EQ X S:158 Y
CRUN Y RUNPROC Quit_Txt
EQ X S:159 Y
CRUN Y RUNPROC Txt_Exit_Save
RUNPROC INSERT_CHARACTER
GOTO Next_Key
@----------------------------------
@Procedures
@----------------------------------
PROC Quit_Txt:
CLS
REGSET MAR 10
MEMLOAD
REGCOPY MDR PC
ENDPROC
@----------------------------------
PROC Txt_Exit_Save:
REGSET Y 0 @Helper iterator
REGSET V 0 @Logic
REGCOPY S:157 MAR
:Write_To_File_Txt_Next_Char
MEMLOAD
WNC Y MDR
DEBUG
LOWER MAR Z V
NOT V
CRUN V RUNPROC Write_EOF
CRUN V RUNPROC Quit_Txt
INC Y
INC MAR
GOTO Write_To_File_Txt_Next_Char
ENDPROC
@----------------------------------
PROC Write_EOF:
WNC Z S:105
INC Z
WNC Z S:106
INC Z
WNC Z S:107
INC Z
WNC Z S:100
ENDPROC
@----------------------------------
PROC Get_Input_To_A0_An:
@Used Registers:
REGSET X 0 @Input
REGSET U 0 @Used for 0 value
REGSET V 0 @Comparison result
REGSET Y -1 @Itterator
:Get_Input_To_A0_An_Iterate
INC Y
INPUT X
EQ X S:103 U @Is input finished?
EQ X S:130 V @Or space is detected?
OR U V V
CRUN V GOTO Get_Input_To_A0_An_END @End reading stdin then
REGCOPY X A:Y
GOTO Get_Input_To_A0_An_Iterate
:Get_Input_To_A0_An_END
REGCOPY S:103 A:Y
ENDPROC
@----------------------------------
PROC Print_File:
REGCOPY S:156 A @Iterator for line lenghts
REGSET S 0 @Temp buffer for MAR value
REGSET X 0 @Logic
REGSET Y 0 @Also Logic
REGSET U 0 @Iterator
REGSET Z 0 @Temp buffer
REGCOPY S:157 MAR @Write the outputed character into RAM, for later use
OUTPUT C52
OUTPUT S:100
OUTPUT C53
OUTPUT S:100
OUTPUT C0
OUTPUT S:100
:Print_File_Nextchar
RNC U Z
EQ Z S:100 X
CRUN X REGCOPY MAR S
CRUN X REGCOPY A MAR
CRUN X REGCOPY S MDR
CRUN X INC MDR
CRUN X MEMWRITE
CRUN X REGCOPY S MAR
CRUN X INC A
CRUN X RUNPROC Search_For_EOF
CRUN Y ENDPROC @If EOF is found end the search
INC U
REGCOPY Z MDR
OUTPUT Z
MEMWRITE
INC MAR
GOTO Print_File_Nextchar
ENDPROC
@----------------------------------
PROC Search_For_EOF:
@Uses U, V, Y
REGSET Y 0
REGSET A:255 104
REGSET A:256 5
:Search_For_EOF_Repeat
INC U
INC Y
RNC U V
ADD Y A:255 Y
EQ V S:Y V
SUB Y A:255 Y
CRUN V GOTO Search_For_EOF_Repeat
REGCOPY Y A:255
EQ Y A:256 Y
SUB U A:255 U @Reset file position
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_FORWARD:
REGCOPY A MAR
MEMLOAD
LOWER U Z X @Don't let the cursor go further than the text's length
NOT X
CRUN X ENDPROC
DEC MDR
LOWER U MDR X
NOT X
CRUN X ENDPROC
REGCOPY U MAR
MEMLOAD
OUTPUT MDR
INC U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_BACK:
HIGHER U S:103 X
DEC A
REGCOPY A MAR
MEMLOAD
HIGHER U MDR X
INC A
NOT X
CRUN X ENDPROC
OUTPUT S:152
DEC U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_UP:
DEC A
LOWER A S:156 X
INC A
INC A
CRUN A EQ A S:156 U
DEC A
DEC A
NOT U
CRUN X CRUN U CURSORUP
CRUN X CRUN U DEC A
CRUN X REGCOPY S:157 U
CRUN X INC A
CRUN X ENDPROC
DEC A
REGCOPY A MAR
MEMLOAD
INC A
CURSORUP
REGCOPY MDR U
REGSET Y 1
ENDPROC
@----------------------------------
PROC MOVE_CURSOR_DOWN:
LOWER A S:160 X
NOT X
CRUN X DEC A
REGCOPY A MAR
MEMLOAD
REGCOPY MDR U
NOT X
CRUN X CURSORDOWN
INC A
REGSET Y 1
ENDPROC
@----------------------------------
PROC INSERT_CHARACTER:
@---------
@Update RAM
REGSET V 0 @Used for Logic operations
REGCOPY Z Y @Helper incremenetor
DEC Y
REGCOPY S:160 MAR
REGCOPY Z MDR
INC MDR
MEMWRITE
REGCOPY Z MAR
INC Z @Add text len by 1
:Shift_Next_Char
COPY Y @Copy Y to MAR (From RAM)
EQ Y U V
CRUN V GOTO Print_Characters
DEC MAR
DEC Y
GOTO Shift_Next_Char
:Print_Characters
REGCOPY X MDR
DEC MAR
MEMWRITE
:Print_Next_Char
EQ MAR Z V
CRUN V GOTO Reset_Cursor
MEMLOAD
OUTPUT MDR
INC MAR
GOTO Print_Next_Char
:Reset_Cursor
INC U
LOWER A S:160 V
CRUN V REGCOPY A X @Backup A Value
CRUN V RUNPROC SET_CURSOR_Y
CRUN V REGCOPY X A @Restore backuped value
CRUN V RUNPROC SET_CURSOR_X
CRUN V ENDPROC
REGCOPY MAR X @Backup MAR value
@Update line length
REGCOPY A MAR
MEMLOAD
INC MDR
MEMWRITE
REGCOPY X MAR @Restore backuped value
:Cursor_Back_Repeat
OUTPUT S:152
DEC MAR
EQ MAR U V
NOT V
CRUN V GOTO Cursor_Back_Repeat
ENDPROC
PROC SET_CURSOR_Y:
REGCOPY A MAR
:Cursor_Up_Repeat
MEMLOAD
INC MDR
MEMWRITE
CURSORUP
INC MAR
EQ MAR S:160 V
CRUN V ENDPROC
GOTO Cursor_Up_Repeat
ENDPROC
PROC SET_CURSOR_X:
LOWER A S:156 V
CRUN V REGCOPY S:157 MAR
CRUN V GOTO Cursor_Forward_Insert_Repeat
REGCOPY A MAR
DEC MAR
MEMLOAD
REGCOPY MDR MAR
:Cursor_Forward_Insert_Repeat
EQ MAR U V
CRUN V ENDPROC
MEMLOAD
OUTPUT MDR
INC MAR
@Inja Boodesh
GOTO Cursor_Forward_Insert_Repeat
ENDPROC
@----------------------------------
PROC ERASE_CHARACTER:
@Check if erasing is allowed or not
LOWER A S:156 V
CRUN V HIGHER U S:157 Y
CRUN V NOT Y
CRUN V CRUN Y REGSET V 1
CRUN V CRUN Y ENDPROC
REGCOPY A MAR
DEC MAR
MEMLOAD
HIGHER U MDR V
NOT V
CRUN V REGSET Y 1
CRUN V ENDPROC
@Update RAM
REGSET V 0 @Used for Logic operations
REGCOPY U Y @Helper incremenetor
REGCOPY S:160 MAR
REGCOPY Z MDR
DEC MDR
MEMWRITE
REGCOPY U MAR
DEC MAR
DEC U
DEC Z @Decrement text len
:Shift_Next_Char_Back
COPY Y @Copy Y to MAR (From RAM)
EQ Y Z V
CRUN V GOTO Print_Characters_Back
INC MAR
INC Y
GOTO Shift_Next_Char_Back
:Print_Characters_Back
CLS
OUTPUT C52
OUTPUT S:100
OUTPUT C53
OUTPUT S:100
OUTPUT C0
OUTPUT S:100
REGCOPY S:157 MAR
:Print_Next_Char_Back
EQ MAR Z V
CRUN V GOTO Reset_Cursor_Back
MEMLOAD
OUTPUT MDR
INC MAR
GOTO Print_Next_Char_Back
:Reset_Cursor_Back
LOWER A S:160 V
CRUN V REGCOPY A X @Backup A Value
CRUN V RUNPROC SET_CURSOR_Y_Back
CRUN V REGCOPY X A @Restore backuped value
CRUN V RUNPROC SET_CURSOR_X
CRUN V ENDPROC
REGCOPY MAR X @Backup MAR value
@Update line length
REGCOPY A MAR
MEMLOAD
DEC MDR
MEMWRITE
REGCOPY X MAR @Restore backuped value
:Cursor_Back_Repeat_Back
OUTPUT S:152
DEC MAR
EQ MAR U V
NOT V
CRUN V GOTO Cursor_Back_Repeat_Back
REGSET Y 1
ENDPROC
PROC SET_CURSOR_Y_Back:
REGCOPY A MAR
:Cursor_Up_Repeat_Back
MEMLOAD
DEC MDR
MEMWRITE
CURSORUP
INC MAR
EQ MAR S:160 V
CRUN V ENDPROC
GOTO Cursor_Up_Repeat_Back
ENDPROC
END



































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































